<!doctype html>
<html>
	<head>
		<meta charset = 'utf-8'>
		<title>寻路</title>
		<style type="text/css">
			body{
				margin:0;
				background-image: url(img/2017.jpg);
			}
			table{
				/*border:1px solid #ccc;*/
				border-collapse: collapse;
				font-family:'楷体';
			}
			td{
				border:1px solid #ccc;
				width:28px;
				height:28px;
			}
		</style>
	</head>

	<body>
		<div id="maintable">
		</div>
		<script type="text/javascript">	
			var SIZE = 15;
			var tdUrl = new Array("url(img/blue.png)","url(img/blue00.png)",
						"url(img/red.png)","url(img/yellow.png)",
						"url(img/green.png)","url(img/purple.png)");
			var infArray = new Array(SIZE*SIZE);
			var num;
			var ok;

			createTable();//创建表格
			initBall ();//微表格添加初始背景
			BeginAndEnd();//获得起始位置
			searchMinPath();//寻找最短路径
			printLine();//打印最短路径

			function createTable(){
				var oDiv = document.getElementById("maintable");
				oDiv.innerHTML = "<center><table><caption>寻路</caption></table></center>";
				var oTable = oDiv.getElementsByTagName("table")[0];
				var oTbody = document.createElement("tbody");
				for(var i = 0; i<SIZE ; i++){
					var oTr = document.createElement("tr");
					for(var j=0 ; j<SIZE ; j++){
						var oTd = document.createElement("td");
						oTr.appendChild(oTd);
					}
					oTbody.appendChild(oTr);
				}
				oTable.appendChild(oTbody);
			}

			function getTd(){
				var oTd = new Array();
				for(var i=0 ; i<SIZE ; i++){
					oTd[i] = document.getElementsByTagName("tr")[i].getElementsByTagName("td");
				}
				return oTd;
			}

			function initBall (){
				var oTd = getTd();
				for(var i=0 ; i<4 ; i++){
					var ranBall = parseInt(Math.random()*6);
					var thisball = tdUrl[ranBall];
					var ranRow = parseInt(Math.random()*SIZE);
					var ranCell = parseInt(Math.random()*SIZE);
					if(oTd[ranRow][ranCell].style.background == ''){
						oTd[ranRow][ranCell].style.background = thisball;
					}
					//oTd[5][6].style.background = tdUrl[ranBall];
				}
			}

			function BeginAndEnd(){
				beginI = parseInt(window.prompt("开始的行：", 0));
				beginJ = parseInt(window.prompt("开始的列：", 0));
				endI = parseInt(window.prompt("结束的行：", 0));
				endJ = parseInt(window.prompt("结束的列：", 0));	
			}

			function gridArray(prepose,curI,curJ,g,f){
				this.prepos= prepose;
				this.curI = curI;
				this.curJ = curJ;
				this.g = g;
				this.f = f;
				this.flag = 1;
			}

			function getF(i,j){
				return Math.abs(i-endI)+Math.abs(j-endJ);
			}

			function putBeginIntoinfArray(){
				num = 0;
				infArray[num] = new gridArray(
					-1,	beginI,	beginJ,	0,getF(beginI,beginJ));
				num++;
				// alert(num);
			}

			function getMinGF(){
				var i = 0;
				var min;
				for(;i<num ; i++){
					if(infArray[i].flag == 1)
						break;
				}

				if(!(i < num))
					return -1;

				var pos = i;
				min = infArray[i].g+infArray[i].f;
				for( ; i < num ; i++){
					if( infArray[i].f+infArray.f <min && infArray[i].flag ==1){
						min = infArray[i].g+infArray[i].f;
						pos = i;
					}
				}
				//alert(infArray[pos].curI+" "+infArray[pos].curJ+" "+num);
				return pos;
			}

			function Addinf(prepos,curI,curJ,g,f){
				var i;
				for(i =0 ; i<num ; i++){
					if(infArray[i].curI==curI&&infArray[i].curJ==curJ){
						// alert("你好");
						break; 
					}
				}

				if(!(i < num )){
					infArray[num] = new gridArray(prepos,curI,curJ,g,f);
					num++;
					if(curI == endI && curJ == endJ) 
						ok = 1;
				}else{
					if(infArray[i].flag == 1){
						if(infArray[i].g+infArray[i].f>g+f)
							inf[i].prepos = prepos;
					}
				}
			}

			function searchMinPath(){
				putBeginIntoinfArray();//添加初始位置

				ok = 0;
				var oTd = getTd();
				while( ok == 0){
					var pos = getMinGF();//获取g+f最小的

					if(pos == -1){
						alert("无路可走");
					}else{
						infArray[pos].flag = 2;
						// alert(infArray[pos].prepos);
					}
					// alert(oTd);
					var curI = infArray[pos].curI;
					var curJ = infArray[pos].curJ;
					var g = infArray[pos].g+1;
					if(ok == 0 && curI > 0 && oTd[curI-1][curJ].style.background == ''){//上
						Addinf(pos,curI-1,curJ,g,getF(curI-1,curJ));
					}
					if(ok == 0 && curI < SIZE-1 && oTd[curI+1][curJ].style.background == ''){//下
						Addinf(pos,curI+1,curJ,g,getF(curI+1,curJ));
					}
					if(ok == 0 && curJ > 0 && oTd[curI][curJ-1].style.background == ''){//左
						Addinf(pos,curI,curJ-1,g,getF(curI,curJ-1));
					}
					if(ok == 0 && curJ <SIZE-1 && oTd[curI][curJ+1].style.background == ''){//右
						Addinf(pos,curI,curJ+1,g,getF(curI,curJ+1));
					}
				}
			}

			function printLine(){
				if(ok == 1){
					var i,j;
					num--;
					var oTd = getTd();
					do{
						i = infArray[num].curI;
						j = infArray[num].curJ;
						oTd[i][j].style.background = "url(img/gray.png)";
						num = infArray[num].prepos;
					}while( num != -1);
				}
			}
			
		</script>	
	</body>
</html>